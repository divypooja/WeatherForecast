{% extends "base.html" %}

{% block title %}Unified Multi-State Inventory - AK Innovations Factory Management{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title"><i class="fas fa-layer-group"></i> Unified Multi-State Inventory</h1>
            <p class="page-subtitle">Track inventory across Raw, WIP, Finished, and Scrap states</p>
        </div>
        <div>
            <a href="{{ url_for('inventory.dashboard') }}" class="btn btn-secondary me-2">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <a href="{{ url_for('inventory.batch_wise_view') }}" class="btn btn-info">
                <i class="fas fa-barcode"></i> Batch-wise View
            </a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-2 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Total Items</h5>
                    <h3>{{ summary.total_items }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-2 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Raw Material</h5>
                    <h3>{{ "%.1f"|format(summary.total_raw) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-2 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">WIP</h5>
                    <h3>{{ "%.1f"|format(summary.total_wip) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-2 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Finished</h5>
                    <h3>{{ "%.1f"|format(summary.total_finished) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-2 mb-3">
            <div class="card bg-danger text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Scrap</h5>
                    <h3>{{ "%.1f"|format(summary.total_scrap) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-2 mb-3">
            <div class="card bg-dark text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Available</h5>
                    <h3>{{ "%.1f"|format(summary.total_available) }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Multi-State Inventory Table -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-table"></i> Multi-State Inventory Breakdown
            </h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="multiStateTable">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th>Item Code</th>
                            <th>Item Name</th>
                            <th>Type</th>
                            <th>UOM</th>
                            <th class="text-center">Raw</th>
                            <th class="text-center">WIP</th>
                            <th class="text-center">Finished</th>
                            <th class="text-center">Scrap</th>
                            <th class="text-center">Total</th>
                            <th class="text-center">Available</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Min Stock</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in inventory_data %}
                        <tr>
                            <td><strong>{{ item.item_code }}</strong></td>
                            <td>{{ item.item_name }}</td>
                            <td>
                                <span class="badge bg-secondary">{{ item.item_type }}</span>
                            </td>
                            <td>{{ item.uom }}</td>
                            <td class="text-center">
                                <span class="badge bg-primary">{{ "%.1f"|format(item.raw) }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-warning">{{ "%.1f"|format(item.wip) }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-success">{{ "%.1f"|format(item.finished) }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-danger">{{ "%.1f"|format(item.scrap) }}</span>
                            </td>
                            <td class="text-center">
                                <strong>{{ "%.1f"|format(item.total) }}</strong>
                            </td>
                            <td class="text-center">
                                <strong>{{ "%.1f"|format(item.available) }}</strong>
                            </td>
                            <td class="text-center">
                                {% if item.status == 'Out of Stock' %}
                                    <span class="badge bg-danger">{{ item.status }}</span>
                                {% elif item.status == 'Low Stock' %}
                                    <span class="badge bg-warning">{{ item.status }}</span>
                                {% else %}
                                    <span class="badge bg-success">{{ item.status }}</span>
                                {% endif %}
                            </td>
                            <td class="text-center">{{ "%.1f"|format(item.min_stock) }}</td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <a href="{{ url_for('inventory.view_item', id=item.item_code) }}" 
                                       class="btn btn-sm btn-outline-primary" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('inventory.batch_wise_view') }}?item={{ item.item_code }}" 
                                       class="btn btn-sm btn-outline-info" title="View Batches">
                                        <i class="fas fa-barcode"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="13" class="text-center">
                                <div class="py-4">
                                    <i class="fas fa-box-open fa-3x text-muted"></i>
                                    <p class="mt-3 text-muted">No inventory data available</p>
                                    <a href="{{ url_for('inventory.add_item') }}" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> Add First Item
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize DataTable with enhanced features
$(document).ready(function() {
    $('#multiStateTable').DataTable({
        "pageLength": 25,
        "order": [[ 0, "asc" ]],
        "columnDefs": [
            { "orderable": false, "targets": -1 }
        ],
        "dom": 'Bfrtip',
        "buttons": [
            'copy', 'csv', 'excel', 'print'
        ],
        "responsive": true,
        "scrollX": true
    });
});
</script>
{% endblock %}