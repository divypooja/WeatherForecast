{% extends "base.html" %}

{% block title %}Inventory Dashboard - Factory Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1><i class="fas fa-boxes"></i> Inventory Dashboard</h1>
            <p class="text-muted">Real-time inventory monitoring and multi-state tracking</p>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('inventory.add_item') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Item
            </a>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Total Items</h5>
                            <h3>{{ stats.total_items }}</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-box fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Work Alerts</h5>
                            <h3>{{ stats.work_alerts }}</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Low Stock</h5>
                            <h3>{{ stats.low_stock }}</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-arrow-down fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Out of Stock</h5>
                            <h3>{{ stats.out_of_stock }}</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-times-circle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Multi-State View Toggle -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-layer-group"></i> Multi-State Inventory Overview</h5>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="multiStateView" checked>
                        <label class="form-check-label" for="multiStateView">Multi-State View</label>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h6 class="text-muted">Raw Materials</h6>
                            <h4 class="mb-0">{{ multi_state_stats.raw_materials }}</h4>
                        </div>
                        <div class="col-md-3">
                            <h6 class="text-muted">Work in Progress</h6>
                            <h4 class="mb-0">{{ multi_state_stats.wip }}</h4>
                        </div>
                        <div class="col-md-3">
                            <h6 class="text-muted">Finished Goods</h6>
                            <h4 class="mb-0">{{ multi_state_stats.finished_goods }}</h4>
                        </div>
                        <div class="col-md-3">
                            <h6 class="text-muted">Scrap</h6>
                            <h4 class="mb-0 text-danger">{{ multi_state_stats.scrap }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Inventory Progress -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Active Stock Progress</h5>
                    <a href="{{ url_for('inventory.view_all') }}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for item in recent_items[:6] %}
                        <div class="col-md-4 mb-3">
                            <div class="card border-0 bg-light">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="mb-0">{{ item.name }}</h6>
                                        <span class="badge bg-{{ 'primary' if item.multi_state_view else 'secondary' }}">
                                            {{ item.multi_state_view or 'Standard' }}
                                        </span>
                                    </div>
                                    <div class="row small">
                                        <div class="col-6">
                                            <strong>Current</strong><br>
                                            {{ "%.2f"|format(item.current_stock) }} {{ item.unit }}
                                        </div>
                                        <div class="col-6">
                                            <strong>Received</strong><br>
                                            {{ "%.2f"|format(item.received_quantity or 0) }}
                                        </div>
                                    </div>
                                    <div class="row small mt-2">
                                        <div class="col-6">Progress</div>
                                        <div class="col-6">Progress</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="progress" style="height: 4px;">
                                                <div class="progress-bar bg-success" 
                                                     style="width: {{ (item.current_stock / (item.reorder_level or 1) * 100) if item.reorder_level else 100 }}%"></div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="progress" style="height: 4px;">
                                                <div class="progress-bar bg-info" 
                                                     style="width: {{ (item.received_quantity / (item.current_stock or 1) * 100) if item.current_stock else 0 }}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">Status not specified</small>
                                        <div class="btn-group btn-group-sm float-end">
                                            <button class="btn btn-outline-primary btn-sm">View Details</button>
                                            <button class="btn btn-outline-secondary btn-sm">Quick Actions</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Summary -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-clipboard-list"></i> Status Summary</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-info-circle"></i> <strong>Fully Automated PO Workflow:</strong> PO status automatically updates from "Sent" 
                        to "Closed" based on GRN material receipt. Only manual action is 
                        cancellation for supplier issues.
                    </div>
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <div class="border rounded p-3">
                                <h5 class="text-success">{{ status_summary.ready }}</h5>
                                <small class="text-muted">Ready</small>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="border rounded p-3">
                                <h5 class="text-warning">{{ status_summary.pending }}</h5>
                                <small class="text-muted">Under 2</small>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="border rounded p-3">
                                <h5 class="text-info">{{ status_summary.completed }}</h5>
                                <small class="text-muted">Under 2</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Unit Distribution</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <tbody>
                                {% for unit in unit_distribution %}
                                <tr>
                                    <td><strong>{{ unit.unit }}</strong></td>
                                    <td class="text-end">{{ unit.count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <a href="{{ url_for('inventory.add_item') }}" class="btn btn-primary w-100 mb-2">
                                <i class="fas fa-plus"></i> Add New Item
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('inventory.stock_entry') }}" class="btn btn-info w-100 mb-2">
                                <i class="fas fa-arrow-up"></i> Stock Tracking
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('reports.inventory_report') }}" class="btn btn-success w-100 mb-2">
                                <i class="fas fa-file-alt"></i> Generate Report
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('inventory.view_all') }}" class="btn btn-secondary w-100 mb-2">
                                <i class="fas fa-list"></i> View All Items
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recently Added Items -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-clock"></i> Recently Added Items</h5>
                    <small class="text-muted">{{ recent_items|length }} items found</small>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Item Name</th>
                                    <th>Current Stock</th>
                                    <th>Unit</th>
                                    <th>State</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in recent_items %}
                                <tr>
                                    <td>
                                        <strong>{{ item.name }}</strong><br>
                                        <small class="text-muted">{{ item.code }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-{{ 'success' if item.current_stock > 0 else 'danger' }}">
                                            {{ "%.2f"|format(item.current_stock) }}
                                        </span>
                                    </td>
                                    <td>{{ item.unit }}</td>
                                    <td>
                                        <span class="badge bg-primary">{{ item.multi_state_view or 'Raw Material' }}</span>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ url_for('inventory.edit_item', id=item.id) }}" 
                                               class="btn btn-outline-primary btn-sm">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{{ url_for('inventory.view_item', id=item.id) }}" 
                                               class="btn btn-outline-info btn-sm">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-4">
                                        <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                        No inventory items found
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Top Low Stock Items</h5>
                </div>
                <div class="card-body">
                    {% for item in low_stock_items[:5] %}
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <strong>{{ item.name }}</strong><br>
                            <small class="text-muted">{{ item.code }}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-warning">{{ "%.1f"|format(item.current_stock) }}</span><br>
                            <small class="text-muted">{{ item.unit }}</small>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-muted text-center">
                        <i class="fas fa-check-circle"></i><br>
                        All items are well stocked
                    </p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Multi-state view toggle
    const multiStateToggle = document.getElementById('multiStateView');
    if (multiStateToggle) {
        multiStateToggle.addEventListener('change', function() {
            // Add logic to toggle multi-state view
            console.log('Multi-state view:', this.checked);
        });
    }
});
</script>
{% endblock %}
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
}

.status-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
}

.batch-explorer {
    background: #fff;
    border-radius: 10px;
    padding: 1rem;
    border: 1px solid #e9ecef;
    margin: 0.5rem 0;
}

.chart-container {
    position: relative;
    height: 200px;
    background: #fff;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="inventory-header">
        <div class="row align-items-center">
            <div class="col">
                <h1><i class="fas fa-warehouse"></i> Inventory Control Center</h1>
                <p class="mb-0">Real-time inventory monitoring and multi-state tracking</p>
            </div>
            <div class="col-auto">
                <button class="btn btn-light btn-lg quick-action-btn me-2" onclick="window.location.href='{{ url_for('inventory.multi_state_view') }}'">
                    <i class="fas fa-layer-group"></i> Multi-State View
                </button>
                <button class="btn btn-light btn-lg quick-action-btn" onclick="window.location.href='{{ url_for('inventory.add_item') }}'">
                    <i class="fas fa-plus"></i> Add Item
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs nav-tabs-custom" id="inventoryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button">
                <i class="fas fa-tachometer-alt"></i> Overview
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="alerts-tab" data-bs-toggle="tab" data-bs-target="#alerts" type="button">
                <i class="fas fa-exclamation-triangle"></i> Stock Alerts
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="batches-tab" data-bs-toggle="tab" data-bs-target="#batches" type="button">
                <i class="fas fa-boxes"></i> Batch Tracking
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button">
                <i class="fas fa-chart-line"></i> Analytics
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="valuation-tab" data-bs-toggle="tab" data-bs-target="#valuation" type="button">
                <i class="fas fa-rupee-sign"></i> Valuation
            </button>
        </li>
    </ul>

    <div class="tab-content" id="inventoryTabsContent">

        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel">
            <!-- Enhanced Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="metric-card primary">
                        <div class="metric-label">Total Inventory Items</div>
                        <div class="metric-number">{{ stats.total_items }}</div>
                        <div class="d-flex align-items-center mt-2">
                            <i class="fas fa-warehouse text-primary me-2"></i>
                            <small class="text-muted">Active SKUs</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="metric-card warning">
                        <div class="metric-label">Low Stock Alerts</div>
                        <div class="metric-number">{{ stats.low_stock_items }}</div>
                        <div class="d-flex align-items-center mt-2">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <small class="text-muted">Need Reorder</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="metric-card success">
                        <div class="metric-label">Total Stock Value</div>
                        <div class="metric-number">₹{{ "%.0f"|format(stats.total_stock_value) }}</div>
                        <div class="d-flex align-items-center mt-2">
                            <i class="fas fa-chart-line text-success me-2"></i>
                            <small class="text-muted">Inventory Worth</small>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3 mb-3">
                    <div class="metric-card danger">
                        <div class="metric-label">Out of Stock</div>
                        <div class="metric-number">{{ stats.out_of_stock_items }}</div>
                        <div class="d-flex align-items-center mt-2">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <small class="text-muted">Critical Items</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Inventory Status -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="inventory-card">
                        <div class="card-header bg-transparent">
                            <h5><i class="fas fa-layer-group"></i> Multi-State Inventory Overview</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 text-center">
                                    <div class="metric-number text-info">{{ stats.get('raw_material_items', 0) }}</div>
                                    <div class="metric-label">Raw Materials</div>
                                    <div class="stock-level-indicator stock-level-medium"></div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-number text-warning">{{ stats.get('wip_items', 0) }}</div>
                                    <div class="metric-label">Work in Progress</div>
                                    <div class="stock-level-indicator stock-level-low"></div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-number text-success">{{ stats.get('finished_goods_items', 0) }}</div>
                                    <div class="metric-label">Finished Goods</div>
                                    <div class="stock-level-indicator stock-level-high"></div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="metric-number text-secondary">{{ stats.get('scrap_items', 0) }}</div>
                                    <div class="metric-label">Scrap</div>
                                    <div class="stock-level-indicator stock-level-low"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="inventory-card">
                        <div class="card-header bg-transparent">
                            <h5><i class="fas fa-bolt"></i> Quick Actions</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary quick-action-btn" onclick="window.location.href='{{ url_for('inventory.list_items') }}'">
                                    <i class="fas fa-list"></i> View All Items
                                </button>
                                <button class="btn btn-warning quick-action-btn" onclick="window.location.href='{{ url_for('inventory.list_items', search='') }}?low_stock=true'">
                                    <i class="fas fa-exclamation-triangle"></i> Low Stock Items
                                </button>
                                <button class="btn btn-info quick-action-btn" onclick="window.location.href='{{ url_for('inventory.batch_tracking_dashboard') }}'">
                                    <i class="fas fa-cubes"></i> Batch Tracking
                                </button>
                                <button class="btn btn-success quick-action-btn" onclick="window.location.href='{{ url_for('reports.inventory_report') }}'">
                                    <i class="fas fa-chart-bar"></i> Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Items - Enhanced Card View -->
            <div class="row">
                <div class="col-md-8 mb-4">
                    <div class="inventory-card">
                        <div class="card-header bg-transparent">
                            <h5><i class="fas fa-history"></i> Recently Added Items</h5>
                        </div>
                        <div class="card-body">
                            {% if recent_items %}
                                {% for item in recent_items %}
                                <div class="item-card">
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <h6 class="mb-1">{{ item.code }}</h6>
                                            <small class="text-muted">{{ item.name[:30] }}{{ '...' if item.name|length > 30 else '' }}</small>
                                        </div>
                                        <div class="col-md-2">
                                            <span class="status-badge bg-info text-white">{{ item.item_type.title() }}</span>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <div class="fw-bold">{{ item.current_stock or 0 }}</div>
                                                <small class="text-muted ms-1">{{ item.unit_of_measure }}</small>
                                            </div>
                                            <div class="stock-level-indicator {{ 'stock-level-low' if (item.current_stock or 0) <= (item.minimum_stock or 0) else 'stock-level-high' }}"></div>
                                        </div>
                                        <div class="col-md-2">
                                            <small class="text-muted">₹{{ "%.2f"|format(item.unit_price or 0) }}</small>
                                        </div>
                                        <div class="col-md-2 text-end">
                                            <button class="btn btn-sm btn-outline-primary" onclick="viewItemDetails('{{ item.id }}')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                                    <h6>No recent items</h6>
                                    <p class="text-muted">Add your first inventory item to see activity here</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-4">
                    <div class="inventory-card">
                        <div class="card-header bg-transparent">
                            <h5><i class="fas fa-chart-pie"></i> Unit Distribution</h5>
                        </div>
                        <div class="card-body">
                            {% if uom_stats %}
                                {% for uom, count in uom_stats[:6] %}
                                <div class="batch-explorer mb-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">{{ uom.upper() }}</h6>
                                            <small class="text-muted">{{ count }} items</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="metric-number" style="font-size: 1.5rem;">{{ count }}</div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-ruler fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">No units defined</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stock Alerts Tab -->
        <div class="tab-pane fade" id="alerts" role="tabpanel">
            <div class="inventory-card">
                <div class="card-header bg-transparent">
                    <h5><i class="fas fa-exclamation-triangle"></i> Stock Alert Center</h5>
                </div>
                <div class="card-body">
                    {% if low_stock_items %}
                        {% for item in low_stock_items %}
                        <div class="item-card border-warning">
                            <div class="row align-items-center">
                                <div class="col-md-4">
                                    <h6 class="mb-1">{{ item.name }}</h6>
                                    <small class="text-muted">{{ item.code }}</small>
                                </div>
                                <div class="col-md-2">
                                    <div class="text-center">
                                        <div class="fw-bold text-danger">{{ item.current_stock or 0 }}</div>
                                        <small class="text-muted">Current</small>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="text-center">
                                        <div class="fw-bold">{{ item.minimum_stock or 0 }}</div>
                                        <small class="text-muted">Minimum</small>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="text-center">
                                        <div class="fw-bold">{{ item.unit_of_measure }}</div>
                                        <small class="text-muted">Unit</small>
                                    </div>
                                </div>
                                <div class="col-md-2 text-end">
                                    <button class="btn btn-sm btn-warning">
                                        <i class="fas fa-shopping-cart"></i> Reorder
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                            <h5>All Good!</h5>
                            <p class="text-muted">All items are above minimum stock levels</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Batch Tracking Tab -->
        <div class="tab-pane fade" id="batches" role="tabpanel">
            <div class="inventory-card">
                <div class="card-body">
                    <h5><i class="fas fa-boxes"></i> Batch Management</h5>
                    <p class="text-muted">Track inventory across all batch states and processes</p>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <button class="btn btn-primary w-100" onclick="window.location.href='{{ url_for('inventory.batch_tracking_dashboard') }}'">
                                <i class="fas fa-cubes"></i> Batch Tracking Dashboard
                            </button>
                        </div>
                        <div class="col-md-6 mb-3">
                            <button class="btn btn-info w-100" onclick="window.location.href='{{ url_for('inventory.multi_state_view') }}'">
                                <i class="fas fa-layer-group"></i> Multi-State View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-pane fade" id="analytics" role="tabpanel">
            <div class="inventory-card">
                <div class="card-body">
                    <h5><i class="fas fa-chart-line"></i> Inventory Analytics</h5>
                    <p class="text-muted">Comprehensive inventory analysis and reporting</p>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-success w-100" onclick="window.location.href='{{ url_for('reports.inventory_report') }}'">
                                <i class="fas fa-chart-bar"></i> Inventory Report
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-warning w-100" onclick="window.location.href='{{ url_for('reports.export_inventory') }}'">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <button class="btn btn-info w-100" onclick="window.location.href='{{ url_for('live_status.wip_breakdown') }}'">
                                <i class="fas fa-chart-pie"></i> WIP Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Valuation Tab -->
        <div class="tab-pane fade" id="valuation" role="tabpanel">
            <div class="inventory-card">
                <div class="card-header bg-transparent">
                    <h5><i class="fas fa-rupee-sign"></i> Inventory Valuation</h5>
                </div>
                <div class="card-body">
                    <div class="inventory-summary">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <div class="metric-number">₹{{ "%.0f"|format(stats.total_stock_value) }}</div>
                                <div class="metric-label">Total Value</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-number">₹{{ "%.0f"|format(stats.total_stock_value / stats.total_items if stats.total_items > 0 else 0) }}</div>
                                <div class="metric-label">Avg. Item Value</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-number">{{ stats.total_items }}</div>
                                <div class="metric-label">Total Items</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-number">{{ "%.1f"|format((stats.total_items - stats.out_of_stock_items) / stats.total_items * 100 if stats.total_items > 0 else 0) }}%</div>
                                <div class="metric-label">Stock Health</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function viewItemDetails(itemId) {
    window.location.href = `/inventory/view/${itemId}`;
}

// Tab initialization
document.addEventListener('DOMContentLoaded', function() {
    var triggerTabList = [].slice.call(document.querySelectorAll('#inventoryTabs button'));
    triggerTabList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl);
        triggerEl.addEventListener('click', function (event) {
            event.preventDefault();
            tabTrigger.show();
        });
    });
});
</script>
{% endblock %}
