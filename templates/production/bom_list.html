{% extends "base.html" %}

{% block title %}Bill of Materials - Factory Management System{% endblock %}

{% block extra_css %}
<style>
.bom-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.feature-toggle {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
    backdrop-filter: blur(10px);
}

.feature-toggle h6 {
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.toggle-switch {
    position: relative;
    width: 60px;
    height: 30px;
    background-color: #ccc;
    border-radius: 15px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.toggle-switch.active {
    background-color: #4CAF50;
}

.toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 26px;
    height: 26px;
    background-color: white;
    border-radius: 50%;
    transition: transform 0.3s;
}

.toggle-switch.active .toggle-slider {
    transform: translateX(30px);
}

.bom-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: none;
    transition: all 0.3s ease;
}

.bom-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.data-table {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.data-table thead th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1rem;
    font-weight: 600;
}

.data-table tbody tr {
    transition: all 0.3s ease;
}

.data-table tbody tr:hover {
    background: #f8f9ff;
    transform: scale(1.01);
}

.cost-badge {
    background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
    color: #2d3436;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: bold;
    display: inline-block;
}

.floating-actions {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
}

.fab {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    font-size: 1.5rem;
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
    cursor: pointer;
}

.fab:hover {
    transform: scale(1.1);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}

.fab.secondary {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    width: 50px;
    height: 50px;
    font-size: 1.25rem;
}

.search-panel {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.bulk-actions {
    background: rgba(102, 126, 234, 0.1);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: none;
}

.bulk-actions.show {
    display: block;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Enhanced BOM Header with Feature Toggles -->
    <div class="bom-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="display-5 mb-2">
                    <i class="fas fa-sitemap me-3"></i>
                    Enhanced Bill of Materials
                </h1>
                <p class="lead mb-0">Advanced BOM management with intelligent features</p>
            </div>
            <div class="col-md-6">
                <!-- Feature Toggle Panel -->
                <div class="row">
                    <div class="col-6">
                        <div class="feature-toggle">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6><i class="fas fa-chart-line me-2"></i>Cost Analysis</h6>
                                    <small>Real-time cost tracking</small>
                                </div>
                                <div class="toggle-switch active" data-feature="cost_analysis">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-toggle">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6><i class="fas fa-brain me-2"></i>AI Insights</h6>
                                    <small>Smart optimization</small>
                                </div>
                                <div class="toggle-switch active" data-feature="ai_insights">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="feature-toggle">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6><i class="fas fa-tasks me-2"></i>Bulk Ops</h6>
                                    <small>Mass operations</small>
                                </div>
                                <div class="toggle-switch active" data-feature="bulk_operations">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-toggle">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6><i class="fas fa-download me-2"></i>Export</h6>
                                    <small>Advanced exports</small>
                                </div>
                                <div class="toggle-switch active" data-feature="export_functions">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Search Panel -->
    <div class="search-panel" id="searchPanel">
        <div class="row align-items-center">
            <div class="col-md-3">
                <label class="form-label">Search BOMs</label>
                <input type="text" class="form-control" id="bomSearch" placeholder="BOM code, product name...">
            </div>
            <div class="col-md-2">
                <label class="form-label">Status</label>
                <select class="form-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="draft">Draft</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Cost Range</label>
                <input type="range" class="form-range" id="costRange" min="0" max="10000" value="10000">
                <small class="text-muted">Up to ₹<span id="costValue">10000</span></small>
            </div>
            <div class="col-md-3">
                <label class="form-label">Date Range</label>
                <input type="date" class="form-control" id="dateFrom" style="display: inline-block; width: 48%;">
                <input type="date" class="form-control" id="dateTo" style="display: inline-block; width: 48%; margin-left: 4%;">
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <div class="d-flex gap-1">
                    <button class="btn btn-primary" onclick="applyFilters()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="btn btn-outline-secondary" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Actions Panel -->
    <div class="bulk-actions" id="bulkActions">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <strong><span id="selectedCount">0</span> BOMs selected</strong>
            </div>
            <div class="btn-group">
                <button class="btn btn-success btn-sm" onclick="bulkActivate()">
                    <i class="fas fa-check"></i> Activate
                </button>
                <button class="btn btn-warning btn-sm" onclick="bulkDeactivate()">
                    <i class="fas fa-pause"></i> Deactivate
                </button>
                <button class="btn btn-info btn-sm" onclick="bulkDuplicate()">
                    <i class="fas fa-copy"></i> Duplicate
                </button>
                <button class="btn btn-danger btn-sm" onclick="bulkDelete()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced BOMs Table -->
    <div class="bom-card">
        <div class="card-body p-0">
            {% if boms.items %}
                <div class="table-responsive">
                    <table class="table table-hover data-table mb-0" id="bomTable">
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" class="form-check-input" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>BOM Code</th>
                                <th>Product</th>
                                <th>Version</th>
                                <th>Components</th>
                                <th>Total Cost</th>
                                <th>Status</th>
                                <th>AI Score</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bom in boms.items %}
                            <tr data-bom-id="{{ bom.id }}" class="bom-row">
                                <td>
                                    <input type="checkbox" class="form-check-input bom-checkbox" value="{{ bom.id }}" onchange="updateBulkActions()">
                                </td>
                                <td>
                                    <strong>{{ bom.bom_code }}</strong>
                                    <br><small class="text-muted">{{ bom.created_at.strftime('%d %b %Y') if bom.created_at else 'N/A' }}</small>
                                </td>
                                <td>
                                    <strong>{{ bom.product.name if bom.product else 'Unknown Product' }}</strong>
                                    <br><small class="text-muted">{{ bom.product.code if bom.product else '' }}</small>
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ bom.version }}</span>
                                    <br><small class="text-muted">{{ bom.output_quantity or 1.0 }} units</small>
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ bom.items|length }} items</span>
                                    {% if bom.processes %}
                                    <br><span class="badge bg-success">{{ bom.processes|length }} processes</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="cost-badge" id="costAnalysis-{{ bom.id }}">
                                        ₹{{ "%.2f"|format(bom.total_material_cost if bom.total_material_cost else 0) }}
                                    </div>
                                    {% if bom.labor_cost_per_unit %}
                                    <br><small class="text-muted">Labor: ₹{{ "%.2f"|format(bom.labor_cost_per_unit) }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if bom.status == 'active' else 'secondary' }}">
                                        {{ bom.status.title() }}
                                    </span>
                                    {% if bom.is_phantom_bom %}
                                    <br><span class="badge bg-warning">Phantom</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="ai-insights" id="aiInsights-{{ bom.id }}">
                                        <div class="d-flex align-items-center">
                                            <div class="progress me-2" style="width: 60px; height: 8px;">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: {{ (95 - (bom.estimated_scrap_percent or 0) * 5)|round }}%"></div>
                                            </div>
                                            <small>{{ (95 - (bom.estimated_scrap_percent or 0) * 5)|round }}%</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('production.view_bom', id=bom.id) }}" class="btn btn-outline-primary" title="View">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ url_for('production.edit_bom', id=bom.id) }}" class="btn btn-outline-warning" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button class="btn btn-outline-info" onclick="duplicateBOM({{ bom.id }})" title="Duplicate">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" title="More">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="#" onclick="optimizeBOM({{ bom.id }})">
                                                    <i class="fas fa-magic me-2"></i>Optimize
                                                </a></li>
                                                <li><a class="dropdown-item" href="#" onclick="exportBOM({{ bom.id }})">
                                                    <i class="fas fa-download me-2"></i>Export
                                                </a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-danger" href="{{ url_for('production.delete_bom', id=bom.id) }}" 
                                                       onclick="return confirm('Are you sure you want to delete this BOM?')">
                                                    <i class="fas fa-trash me-2"></i>Delete
                                                </a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                {% if boms.pages > 1 %}
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        {% if boms.has_prev %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('production.list_bom', page=boms.prev_num) }}">Previous</a>
                            </li>
                        {% endif %}
                        
                        {% for page_num in boms.iter_pages() %}
                            {% if page_num %}
                                {% if page_num != boms.page %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('production.list_bom', page=page_num) }}">{{ page_num }}</a>
                                    </li>
                                {% else %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                {% endif %}
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">…</span>
                                </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if boms.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('production.list_bom', page=boms.next_num) }}">Next</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-sitemap text-muted" style="font-size: 4rem;"></i>
                    <h4 class="text-muted mt-3">No Bill of Materials found</h4>
                    <p class="text-muted">Start by creating your first BOM with advanced features</p>
                    <div class="d-flex justify-content-center gap-2">
                        <a href="{{ url_for('production.add_bom') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Create BOM
                        </a>
                        <button class="btn btn-outline-info" onclick="loadTemplate()">
                            <i class="fas fa-copy me-2"></i>Use Template
                        </button>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="floating-actions">
        <button class="fab" onclick="showQuickActions()" title="Quick Actions">
            <i class="fas fa-plus"></i>
        </button>
        <button class="fab secondary" onclick="toggleFeatures()" title="Toggle Features" id="featuresToggle">
            <i class="fas fa-cog"></i>
        </button>
        <button class="fab secondary" onclick="exportAll()" title="Export All" id="exportBtn">
            <i class="fas fa-download"></i>
        </button>
    </div>
</div>

<!-- Quick Actions Modal -->
<div class="modal fade" id="quickActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">BOM Quick Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Create BOM</h6>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('production.add_bom') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>From Scratch
                            </a>
                            <button class="btn btn-outline-primary" onclick="createFromTemplate()">
                                <i class="fas fa-copy me-2"></i>From Template
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Bulk Operations</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success" onclick="exportAllBOMs()">
                                <i class="fas fa-download me-2"></i>Export All
                            </button>
                            <button class="btn btn-outline-info" onclick="analyzeAllBOMs()">
                                <i class="fas fa-chart-line me-2"></i>Analyze Costs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- BOM Optimization Modal -->
<div class="modal fade" id="optimizationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">BOM Optimization Suggestions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="optimizationContent">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Feature toggle states
let features = {
    cost_analysis: true,
    ai_insights: true,
    bulk_operations: true,
    export_functions: true
};

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    setupFeatureToggles();
    setupSearchFilters();
    updateFeatureVisibility();
});

function setupFeatureToggles() {
    document.querySelectorAll('.toggle-switch').forEach(toggle => {
        toggle.addEventListener('click', function() {
            const feature = this.dataset.feature;
            const isActive = this.classList.contains('active');
            
            if (isActive) {
                this.classList.remove('active');
                features[feature] = false;
            } else {
                this.classList.add('active');
                features[feature] = true;
            }
            
            updateFeatureVisibility();
            saveFeaturePreferences();
        });
    });
}

function updateFeatureVisibility() {
    // Cost Analysis
    document.querySelectorAll('[id^="costAnalysis-"]').forEach(el => {
        el.style.display = features.cost_analysis ? 'block' : 'none';
    });
    
    // AI Insights
    document.querySelectorAll('[id^="aiInsights-"]').forEach(el => {
        el.style.display = features.ai_insights ? 'block' : 'none';
    });
    
    // Bulk Operations
    document.getElementById('bulkActions').style.display = features.bulk_operations ? 'block' : 'none';
    document.querySelectorAll('.bom-checkbox').forEach(cb => {
        cb.style.display = features.bulk_operations ? 'block' : 'none';
    });
    document.getElementById('selectAll').style.display = features.bulk_operations ? 'block' : 'none';
    
    // Export Functions
    document.getElementById('exportBtn').style.display = features.export_functions ? 'block' : 'none';
}

function setupSearchFilters() {
    // Real-time search
    document.getElementById('bomSearch').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        filterBOMTable();
    });
    
    // Status filter
    document.getElementById('statusFilter').addEventListener('change', filterBOMTable);
    
    // Cost range
    document.getElementById('costRange').addEventListener('input', function() {
        document.getElementById('costValue').textContent = this.value;
        filterBOMTable();
    });
}

function filterBOMTable() {
    const searchTerm = document.getElementById('bomSearch').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const costLimit = parseFloat(document.getElementById('costRange').value);
    
    document.querySelectorAll('.bom-row').forEach(row => {
        let visible = true;
        
        // Text search
        if (searchTerm && !row.textContent.toLowerCase().includes(searchTerm)) {
            visible = false;
        }
        
        // Status filter
        if (statusFilter) {
            const statusBadge = row.querySelector('.badge');
            if (!statusBadge || !statusBadge.textContent.toLowerCase().includes(statusFilter)) {
                visible = false;
            }
        }
        
        // Cost filter
        const costElement = row.querySelector('.cost-badge');
        if (costElement) {
            const costText = costElement.textContent.replace('₹', '').replace(',', '');
            const cost = parseFloat(costText);
            if (cost > costLimit) {
                visible = false;
            }
        }
        
        row.style.display = visible ? '' : 'none';
    });
}

function toggleSelectAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.bom-checkbox');
    
    checkboxes.forEach(cb => {
        cb.checked = selectAll.checked;
    });
    
    updateBulkActions();
}

function updateBulkActions() {
    const checkedBoxes = document.querySelectorAll('.bom-checkbox:checked');
    const bulkActions = document.getElementById('bulkActions');
    
    if (checkedBoxes.length > 0) {
        bulkActions.classList.add('show');
        document.getElementById('selectedCount').textContent = checkedBoxes.length;
    } else {
        bulkActions.classList.remove('show');
    }
}

function bulkActivate() {
    const selectedIds = getSelectedBOMIds();
    if (selectedIds.length === 0) return;
    
    if (confirm(`Activate ${selectedIds.length} selected BOMs?`)) {
        performBulkOperation('activate', selectedIds);
    }
}

function bulkDeactivate() {
    const selectedIds = getSelectedBOMIds();
    if (selectedIds.length === 0) return;
    
    if (confirm(`Deactivate ${selectedIds.length} selected BOMs?`)) {
        performBulkOperation('deactivate', selectedIds);
    }
}

function bulkDuplicate() {
    const selectedIds = getSelectedBOMIds();
    if (selectedIds.length === 0) return;
    
    if (confirm(`Create duplicates of ${selectedIds.length} selected BOMs?`)) {
        performBulkOperation('duplicate', selectedIds);
    }
}

function bulkDelete() {
    const selectedIds = getSelectedBOMIds();
    if (selectedIds.length === 0) return;
    
    if (confirm(`Delete ${selectedIds.length} selected BOMs? This action cannot be undone.`)) {
        performBulkOperation('delete', selectedIds);
    }
}

function getSelectedBOMIds() {
    return Array.from(document.querySelectorAll('.bom-checkbox:checked')).map(cb => cb.value);
}

function performBulkOperation(operation, bomIds) {
    // In a real implementation, this would make an API call
    console.log(`Performing ${operation} on BOMs:`, bomIds);
    
    // Show loading state
    const bulkActions = document.getElementById('bulkActions');
    bulkActions.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Processing...</div>';
    
    // Simulate API call
    setTimeout(() => {
        alert(`${operation} operation completed for ${bomIds.length} BOMs`);
        location.reload(); // Reload to show updated data
    }, 2000);
}

function duplicateBOM(bomId) {
    if (confirm('Create a duplicate of this BOM?')) {
        console.log('Duplicating BOM:', bomId);
        alert('BOM duplication feature will be implemented');
    }
}

function optimizeBOM(bomId) {
    // Show optimization modal with AI suggestions
    const modal = new bootstrap.Modal(document.getElementById('optimizationModal'));
    const content = document.getElementById('optimizationContent');
    
    content.innerHTML = `
        <div class="text-center">
            <i class="fas fa-spinner fa-spin fa-2x text-primary mb-3"></i>
            <p>Analyzing BOM ${bomId} for optimization opportunities...</p>
        </div>
    `;
    
    modal.show();
    
    // Simulate AI analysis
    setTimeout(() => {
        content.innerHTML = `
            <div class="alert alert-info">
                <h6><i class="fas fa-lightbulb me-2"></i>Optimization Suggestions for BOM-${bomId}</h6>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card border-warning">
                        <div class="card-body">
                            <h6 class="text-warning">Cost Reduction Opportunity</h6>
                            <p>Consider alternative supplier for steel components</p>
                            <small class="text-muted">Potential saving: ₹125/unit</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-success">
                        <div class="card-body">
                            <h6 class="text-success">Process Optimization</h6>
                            <p>Combine cutting and bending operations</p>
                            <small class="text-muted">Time saving: 15 minutes/unit</small>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }, 2000);
}

function exportBOM(bomId) {
    if (!features.export_functions) {
        alert('Export feature is disabled. Enable it in feature toggles.');
        return;
    }
    console.log('Exporting BOM:', bomId);
    alert('BOM export feature will be implemented');
}

function showQuickActions() {
    const modal = new bootstrap.Modal(document.getElementById('quickActionsModal'));
    modal.show();
}

function toggleFeatures() {
    const searchPanel = document.getElementById('searchPanel');
    const isVisible = searchPanel.style.display !== 'none';
    searchPanel.style.display = isVisible ? 'none' : 'block';
}

function exportAll() {
    if (!features.export_functions) {
        alert('Export feature is disabled. Enable it in feature toggles.');
        return;
    }
    alert('Export all BOMs feature will be implemented');
}

function applyFilters() {
    filterBOMTable();
}

function clearFilters() {
    document.getElementById('bomSearch').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('costRange').value = '10000';
    document.getElementById('costValue').textContent = '10000';
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value = '';
    filterBOMTable();
}

function loadTemplate() {
    alert('BOM template loading will be implemented');
}

function createFromTemplate() {
    alert('Create from template feature will be implemented');
}

function exportAllBOMs() {
    exportAll();
}

function analyzeAllBOMs() {
    alert('Cost analysis for all BOMs will be implemented');
}

function saveFeaturePreferences() {
    localStorage.setItem('bomFeatures', JSON.stringify(features));
}

function loadFeaturePreferences() {
    const saved = localStorage.getItem('bomFeatures');
    if (saved) {
        features = { ...features, ...JSON.parse(saved) };
    }
}
</script>
{% endblock %}
