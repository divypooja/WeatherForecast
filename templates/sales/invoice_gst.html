<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GST Invoice - {{ so.so_number }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .invoice-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .invoice-header {
            text-align: center;
            border-bottom: 3px solid #007bff;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .invoice-title {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .company-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .company-info, .invoice-info {
            flex: 1;
        }
        .invoice-info {
            text-align: right;
        }
        .section-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .customer-supplier {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .customer-details, .supplier-details {
            flex: 1;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .customer-details {
            margin-right: 15px;
        }
        .supplier-details {
            margin-left: 15px;
        }
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        .items-table th,
        .items-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .items-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .items-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .text-right {
            text-align: right;
        }
        .text-center {
            text-align: center;
        }
        .totals-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }
        .totals-table {
            border-collapse: collapse;
            min-width: 300px;
        }
        .totals-table td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        .totals-table .label {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .total-row {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        .amount-words {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        .gst-info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Invoice Header -->
        <div class="invoice-header">
            <div class="invoice-title">TAX INVOICE</div>
            <div style="font-size: 14px; color: #666;">GST Compliant Invoice</div>
        </div>

        <!-- Company and Invoice Details -->
        <div class="company-details">
            <div class="company-info">
                <div class="section-title">From:</div>
                <strong>{{ company.company_name if company else 'AK Innovations' }}</strong><br>
                {% if company and company.address %}
                    {{ company.address }}<br>
                    {% if company.city %}{{ company.city }}, {% endif %}
                    {% if company.state %}{{ company.state }} {% endif %}
                    {% if company.pin_code %}{{ company.pin_code }}{% endif %}<br>
                {% endif %}
                {% if company and company.phone %}Phone: {{ company.phone }}<br>{% endif %}
                {% if company and company.email %}Email: {{ company.email }}<br>{% endif %}
                {% if company and company.gst_number %}
                    <strong>GSTIN: {{ company.gst_number }}</strong>
                {% endif %}
            </div>
            <div class="invoice-info">
                <div class="section-title">Invoice Details:</div>
                <strong>Invoice No:</strong> INV-{{ so.so_number }}<br>
                <strong>Date:</strong> {{ so.order_date.strftime('%d/%m/%Y') if so.order_date else 'N/A' }}<br>
                <strong>SO Number:</strong> {{ so.so_number }}<br>
                <strong>Due Date:</strong> {{ so.delivery_date.strftime('%d/%m/%Y') if so.delivery_date else 'N/A' }}<br>
                {% if so.payment_terms %}
                    <strong>Payment Terms:</strong> {{ so.payment_terms }}
                {% endif %}
            </div>
        </div>

        <!-- Customer Details -->
        <div class="customer-supplier">
            <div class="customer-details">
                <div class="section-title">Bill To:</div>
                {% if so.customer %}
                    <strong>{{ so.customer.name }}</strong><br>
                    {% if so.customer.address %}
                        {{ so.customer.address }}<br>
                        {% if so.customer.city %}{{ so.customer.city }}, {% endif %}
                        {% if so.customer.state %}{{ so.customer.state }} {% endif %}
                        {% if so.customer.pin_code %}{{ so.customer.pin_code }}{% endif %}<br>
                    {% endif %}
                    {% if so.customer.phone %}Phone: {{ so.customer.phone }}<br>{% endif %}
                    {% if so.customer.email %}Email: {{ so.customer.email }}<br>{% endif %}
                    {% if so.customer.gst_number %}
                        <strong>GSTIN: {{ so.customer.gst_number }}</strong>
                    {% endif %}
                {% else %}
                    <strong>Customer Details Not Available</strong>
                {% endif %}
            </div>
            <div class="supplier-details">
                <div class="section-title">Ship To:</div>
                {% if so.delivery_notes %}
                    {{ so.delivery_notes }}
                {% else %}
                    Same as Bill To Address
                {% endif %}
            </div>
        </div>

        <!-- GST Information -->
        <div class="gst-info">
            <strong>GST Information:</strong> This invoice is issued as per GST regulations. 
            GST Rate Applied: {{ gst_rate }}%. 
            {% if company and company.gst_number %}
                Our GSTIN: {{ company.gst_number }}
            {% endif %}
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr style="background-color: #4285f4; color: white;">
                    <th style="text-align: center; padding: 8px; font-size: 12px;">S.No.</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">Description of Goods/Services</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">HSN/SAC</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">Quantity</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">Unit</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">Rate (₹)</th>
                    <th style="text-align: center; padding: 8px; font-size: 12px;">Amount (₹)</th>
                </tr>
            </thead>
            <tbody>
                {% if so.items %}
                    {% for item in so.items %}
                    <tr>
                        <td style="text-align: center; padding: 8px; font-size: 11px;">{{ loop.index }}</td>
                        <td style="padding: 8px; font-size: 11px;">
                            {{ item.item.name if item.item else 'N/A' }}
                            {% if item.item and item.item.description %}
                                <br><span style="font-size: 10px; color: #666;">{{ item.item.description }}</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center; padding: 8px; font-size: 11px;">{{ item.item.hsn_code if item.item and item.item.hsn_code else '9999' }}</td>
                        <td style="text-align: right; padding: 8px; font-size: 11px;">{{ "%.2f"|format(item.quantity_ordered or 0) }}</td>
                        <td style="text-align: center; padding: 8px; font-size: 11px;">{{ item.item.unit_of_measure if item.item else 'Nos' }}</td>
                        <td style="text-align: right; padding: 8px; font-size: 11px;">{{ "%.2f"|format(item.unit_price or 0) }}</td>
                        <td style="text-align: right; padding: 8px; font-size: 11px;">{{ "%.2f"|format((item.quantity_ordered or 0) * (item.unit_price or 0)) }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; font-size: 11px; color: #666;">No items found in this sales order</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>

        <!-- Totals Section - Tally Style -->
        <div class="totals-section">
            <table class="totals-table" style="border-collapse: collapse; min-width: 300px;">
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; background-color: #f8f9fa; font-weight: bold; font-size: 11px;">Subtotal:</td>
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right; font-size: 11px;">₹{{ "%.2f"|format(subtotal) }}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; background-color: #f8f9fa; font-weight: bold; font-size: 11px;">CGST ({{ "%.1f"|format(gst_rate/2) }}%):</td>
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right; font-size: 11px;">₹{{ "%.2f"|format(gst_amount/2) }}</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px; background-color: #f8f9fa; font-weight: bold; font-size: 11px;">SGST ({{ "%.1f"|format(gst_rate/2) }}%):</td>
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right; font-size: 11px;">₹{{ "%.2f"|format(gst_amount/2) }}</td>
                </tr>
                <tr style="background-color: #4285f4; color: white;">
                    <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold; font-size: 11px;">Total Amount:</td>
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right; font-weight: bold; font-size: 11px;">₹{{ "%.2f"|format(total_with_gst) }}</td>
                </tr>
            </table>
        </div>

        <!-- Amount in Words - Tally Style -->
        <div style="background-color: #e9ecef; padding: 10px; border: 1px solid #ddd; margin-bottom: 20px; font-size: 11px;">
            <strong>Amount in Words:</strong> {{ amount_words.title() }} Rupees Only
        </div>

        <!-- Terms and Conditions -->
        {% if so.notes %}
        <div style="margin-bottom: 20px;">
            <div class="section-title">Terms & Conditions:</div>
            {{ so.notes }}
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p><strong>{{ company.company_name if company else 'AK Innovations' }}</strong></p>
            <p>This is a computer-generated invoice and does not require a physical signature.</p>
            <p style="font-size: 12px; color: #999;">
                Generated on {{ moment().format('DD/MM/YYYY HH:mm') if moment else '' }}
            </p>
        </div>
    </div>
</body>
</html>